# runc DevOps engineering entry challenge
## Overview
 Wellcome to my projject The goal of this task is to design and implement a DevOps infrastructure for a Django application, focusing on classic tools such as Docker, Gitlab, and...

### The main parts of the challenge:
#### 1. Create a private Docker registry
  - Must be run via Docker Compose
  - Using shekan or smart DNS to get the images

[registry](registry) documentation
#### 2. Server preparation and hardening
  - Disable root login
  - Activating the firewall

[Server pripairing](#prepairing)
#### 3. Implementing CI/CD using Gitlab
  - Build a Docker image for a Django application
  - Pushing an image to a private registry
  - Deploying the application to the server

[app and CI/CD](app) documentation
#### 4. Deploying Django applications and services
  - Django application in two separate containers
  - MariaDB database with high availability configuration
  - Nginx service for load balancing between Django containers


Due to limited resources, we create two very small Debian12 VMs on the personal system 
- One for main services (**VM-1**)
- Another as a registry server (**VM-2**)

### TLD of project:
![TLD of project:](images/runc-task-tld.png)
# prepairing
#### The sections mentioned in the task include the following:
######  Activating the firewall
- We use iptables for the firewall
VM-1 rules:
```bash
# Generated by iptables-save v1.8.9 (nf_tables) on Sun Jul 27 21:38:14 2025
*raw
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
COMMIT
# Completed on Sun Jul 27 21:38:14 2025
# Generated by iptables-save v1.8.9 (nf_tables) on Sun Jul 27 21:38:14 2025
*filter
:INPUT DROP [4:994]
:FORWARD DROP [0:0]
:OUTPUT DROP [87:25260]
:DOCKER - [0:0]
:DOCKER-BRIDGE - [0:0]
:DOCKER-CT - [0:0]
:DOCKER-FORWARD - [0:0]
:DOCKER-ISOLATION-STAGE-1 - [0:0]
:DOCKER-ISOLATION-STAGE-2 - [0:0]
:DOCKER-USER - [0:0]
-A INPUT -i enp1s0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -m conntrack --ctstate INVALID -j DROP
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A INPUT -p tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
-A FORWARD -j DOCKER-USER
-A FORWARD -j DOCKER-FORWARD
-A OUTPUT -o enp1s0 -m conntrack --ctstate ESTABLISHED -j ACCEPT
-A OUTPUT -o enp1s0 -p udp -m udp --dport 53 -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -p tcp -m multiport --dports 80,443 -j ACCEPT
-A OUTPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A OUTPUT -d 192.168.122.173/32 -p tcp -m multiport --dports 8081,8082 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
-A DOCKER ! -i br-24d4390beae5 -o br-24d4390beae5 -j DROP
-A DOCKER ! -i docker0 -o docker0 -j DROP
-A DOCKER-BRIDGE -o br-24d4390beae5 -j DOCKER
-A DOCKER-BRIDGE -o docker0 -j DOCKER
-A DOCKER-CT -o br-24d4390beae5 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A DOCKER-CT -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A DOCKER-FORWARD -j DOCKER-CT
-A DOCKER-FORWARD -j DOCKER-ISOLATION-STAGE-1
-A DOCKER-FORWARD -j DOCKER-BRIDGE
-A DOCKER-FORWARD -i br-24d4390beae5 -j ACCEPT
-A DOCKER-FORWARD -i docker0 -j ACCEPT
-A DOCKER-ISOLATION-STAGE-1 -i br-24d4390beae5 ! -o br-24d4390beae5 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o br-24d4390beae5 -j DROP
COMMIT
# Completed on Sun Jul 27 21:38:14 2025
# Generated by iptables-save v1.8.9 (nf_tables) on Sun Jul 27 21:38:14 2025
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A POSTROUTING -s 172.18.0.0/16 ! -o br-24d4390beae5 -j MASQUERADE
-A DOCKER -i docker0 -j RETURN
-A DOCKER -i br-24d4390beae5 -j RETURN
COMMIT
# Completed on Sun Jul 27 21:38:14 2025
```
VM-2 rules:
```bash
# Generated by iptables-save v1.8.9 (nf_tables) on Sun Jul 27 22:18:43 2025
*raw
:PREROUTING ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A PREROUTING -d 172.18.0.2/32 ! -i br-24d4390beae5 -j DROP
COMMIT
# Completed on Sun Jul 27 22:18:43 2025
# Generated by iptables-save v1.8.9 (nf_tables) on Sun Jul 27 22:18:43 2025
*filter
:INPUT DROP [2:497]
:FORWARD DROP [0:0]
:OUTPUT DROP [15:1140]
:DOCKER - [0:0]
:DOCKER-BRIDGE - [0:0]
:DOCKER-CT - [0:0]
:DOCKER-FORWARD - [0:0]
:DOCKER-ISOLATION-STAGE-1 - [0:0]
:DOCKER-ISOLATION-STAGE-2 - [0:0]
:DOCKER-USER - [0:0]
-A INPUT -i enp1s0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -m conntrack --ctstate INVALID -j DROP
-A INPUT -i lo -j ACCEPT
-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -i enp1s0 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -s 192.168.122.105/32 -i enp1s0 -p udp -m udp --dport 53 -j ACCEPT
-A INPUT -s 192.168.122.105/32 -p tcp -m multiport --dports 8081,8082 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
-A INPUT -s 192.168.122.1/32 -p tcp -m multiport --dports 8081,8082 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
-A FORWARD -j DOCKER-USER
-A FORWARD -j DOCKER-FORWARD
-A OUTPUT -o enp1s0 -m conntrack --ctstate ESTABLISHED -j ACCEPT
-A OUTPUT -o enp1s0 -p udp -m udp --dport 53 -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -p tcp -m multiport --dports 80,443 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
-A OUTPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A DOCKER -d 172.18.0.2/32 ! -i br-24d4390beae5 -o br-24d4390beae5 -p tcp -m tcp --dport 8081 -j ACCEPT
-A DOCKER ! -i br-24d4390beae5 -o br-24d4390beae5 -j DROP
-A DOCKER ! -i docker0 -o docker0 -j DROP
-A DOCKER-BRIDGE -o br-24d4390beae5 -j DOCKER
-A DOCKER-BRIDGE -o docker0 -j DOCKER
-A DOCKER-CT -o br-24d4390beae5 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A DOCKER-CT -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A DOCKER-FORWARD -j DOCKER-CT
-A DOCKER-FORWARD -j DOCKER-ISOLATION-STAGE-1
-A DOCKER-FORWARD -j DOCKER-BRIDGE
-A DOCKER-FORWARD -i br-24d4390beae5 -j ACCEPT
-A DOCKER-FORWARD -i docker0 -j ACCEPT
-A DOCKER-ISOLATION-STAGE-1 -i br-24d4390beae5 ! -o br-24d4390beae5 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o br-24d4390beae5 -j DROP
COMMIT
# Completed on Sun Jul 27 22:18:43 2025
# Generated by iptables-save v1.8.9 (nf_tables) on Sun Jul 27 22:18:43 2025
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
:DOCKER - [0:0]
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A POSTROUTING -s 172.18.0.0/16 ! -o br-24d4390beae5 -j MASQUERADE
-A DOCKER -i docker0 -j RETURN
-A DOCKER -i br-24d4390beae5 -j RETURN
-A DOCKER ! -i br-24d4390beae5 -p tcp -m tcp --dport 8081 -j DNAT --to-destination 172.18.0.2:8081
COMMIT
# Completed on Sun Jul 27 22:18:43 2025
```
######  Disable root login:
- ssh login:
 The value of PermitRootLogin in the sshd_config file is no
- local login:
 I changed root:x:0:0:root:/root:/bin/bash root:x:0:0:root:/root:/sbin/nologin in /etc/passwd
